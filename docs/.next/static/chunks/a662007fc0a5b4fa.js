(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32633,43168,64191,89515,4339,e=>{"use strict";e.s([],32633),e.s(["create",()=>tl],43168),e.s(["formatElapsedTime",()=>R,"getDocumentIndexId",()=>M,"getInnerType",()=>V,"getVectorSize",()=>F,"isArrayType",()=>L,"isGeoPointType",()=>U,"isVectorType",()=>B,"validateSchema",()=>x],76629);let t={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},r={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim,czech:/[^A-Z0-9a-zěščřžýáíéúůóťďĚŠČŘŽÝÁÍÉÓÚŮŤĎ-]+/gim},n=Object.keys(t);var o=e.i(47167);let i=Date.now().toString().slice(5),l=0,s=BigInt(1e3),a=BigInt(1e6),u=BigInt(1e9);function c(e,t){if(t.length<65535)Array.prototype.push.apply(e,t);else{let r=t.length;for(let n=0;n<r;n+=65535)Array.prototype.push.apply(e,t.slice(n,n+65535))}}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";let r=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,r)).toFixed(t<0?0:t))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r])}function d(){return BigInt(Math.floor(1e6*performance.now()))}function h(e){return("number"==typeof e&&(e=BigInt(e)),e<s)?"".concat(e,"ns"):e<a?"".concat(e/s,"μs"):e<u?"".concat(e/a,"ms"):"".concat(e/u,"s")}function p(){var e,t;return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?d():void 0!==o.default&&o.default.release&&"node"===o.default.release.name||void 0!==o.default&&"function"==typeof(null==(t=o.default)||null==(e=t.hrtime)?void 0:e.bigint)?o.default.hrtime.bigint():"undefined"!=typeof performance?d():BigInt(0)}function g(){return"".concat(i,"-").concat(l++)}function m(e,t){return void 0===Object.hasOwn?Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0:Object.hasOwn(e,t)?e[t]:void 0}function y(e,t){return t[1]===e[1]?e[0]-t[0]:t[1]-e[1]}function v(e,t){let r={},n=t.length;for(let o=0;o<n;o++){let n=t[o],i=n.split("."),l=e,s=i.length;for(let e=0;e<s;e++)if("object"==typeof(l=l[i[e]])){if(null!==l&&"lat"in l&&"lon"in l&&"number"==typeof l.lat&&"number"==typeof l.lon){l=r[n]=l;break}else if(!Array.isArray(l)&&null!==l&&e===s-1){l=void 0;break}}else if((null===l||"object"!=typeof l)&&e<s-1){l=void 0;break}void 0!==l&&(r[n]=l)}return r}function S(e,t){return v(e,[t])[t]}let b={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function I(e,t){let r=b[t];if(void 0===r)throw Error(k("INVALID_DISTANCE_SUFFIX",e).message);return e*r}function T(e,t){e.hits=e.hits.map(e=>({...e,document:{...e.document,...t.reduce((e,t)=>{let r=t.split("."),n=r.pop(),o=e;for(let e of r){var i;o[e]=null!=(i=o[e])?i:{},o=o[e]}return o[n]=null,e},e.document)}}))}function O(e){var t;return Array.isArray(e)?e.some(e=>O(e)):(null==e||null==(t=e.constructor)?void 0:t.name)==="AsyncFunction"}let N="intersection"in new Set;function _(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(0===t.length)return new Set;if(1===t.length)return t[0];if(2===t.length){let e=t[0],r=t[1];if(N)return e.intersection(r);let n=new Set,o=e.size<r.size?e:r,i=o===e?r:e;for(let e of o)i.has(e)&&n.add(e);return n}let n={index:0,size:t[0].size};for(let e=1;e<t.length;e++)t[e].size<n.size&&(n.index=e,n.size=t[e].size);if(N){let e=t[n.index];for(let r=0;r<t.length;r++)r!==n.index&&(e=e.intersection(t[r]));return e}let o=t[n.index];for(let e=0;e<t.length;e++){if(e===n.index)continue;let r=t[e];for(let e of o)r.has(e)||o.delete(e)}return o}let D="union"in new Set;function w(e,t){return D?e?e.union(t):t:new Set(e?[...e,...t]:t)}function A(e,t){let r=new Set;for(let n of e)t.has(n)||r.add(n);return r}let E=n.join("\n - "),P={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:'Language "%s" is not supported.\nSupported languages are:\n - '.concat(E),INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/open-source/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.oramasearch for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:'Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.\nInput vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.',WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:'Facet doens\'t support the type "%s".',INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:"Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.\nPlease install it before proceeding with creating an answer session.\nRead more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy\n",PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:"Could not find a chat model defined in the secure proxy plugin configuration.\nPlease provide a chat model before proceeding with creating an answer session.\nRead more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy\n",ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function k(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];let i=Error(function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e.replace(RegExp("%(?:(?<position>\\d+)\\$)?(?<width>-?\\d*\\.?\\d*)(?<type>[dfs])","g"),function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let{width:o,type:i,position:l}=t[t.length-1],s=l?r[Number.parseInt(l)-1]:r.shift(),a=""===o?0:Number.parseInt(o);switch(i){case"d":return s.toString().padStart(a,"0");case"f":{let e=s,[t,r]=o.split(".").map(e=>Number.parseFloat(e));return"number"==typeof r&&r>=0&&(e=e.toFixed(r)),"number"==typeof t&&t>=0?e.toString().padStart(a,"0"):e.toString()}case"s":return a<0?s.toString().padEnd(-a," "):s.toString().padStart(a," ");default:return s}})}(null!=(t=P[e])?t:"Unsupported Orama Error code: ".concat(e),...n));return i.code=e,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(i),i}function R(e){return{raw:Number(e),formatted:h(e)}}function M(e){if(e.id){if("string"!=typeof e.id)throw k("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return g()}function x(e,t){for(let[r,n]of Object.entries(t)){let t=e[r];if(void 0!==t&&("geopoint"!==n||"object"!=typeof t||"number"!=typeof t.lon||"number"!=typeof t.lat)&&("enum"!==n||"string"!=typeof t&&"number"!=typeof t)){if("enum[]"===n&&Array.isArray(t)){let e=t.length;for(let n=0;n<e;n++)if("string"!=typeof t[n]&&"number"!=typeof t[n])return r+"."+n;continue}if(B(n)){let e=F(n);if(!Array.isArray(t)||t.length!==e)throw k("INVALID_INPUT_VECTOR",r,e,t.length);continue}if(L(n)){if(!Array.isArray(t))return r;let e=C[n],o=t.length;for(let n=0;n<o;n++)if(typeof t[n]!==e)return r+"."+n;continue}if("object"==typeof n){if(!t||"object"!=typeof t)return r;let e=x(t,n);if(e)return r+"."+e;continue}if(typeof t!==n)return r}}}let z={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},C={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function U(e){return"geopoint"===e}function B(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function L(e){return"string"==typeof e&&z[e]}function V(e){return C[e]}function F(e){let t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw k("INVALID_VECTOR_VALUE",e);case t<=0:throw k("INVALID_VECTOR_SIZE",e);default:return t}}function W(){return{idToInternalId:new Map,internalIdToId:[],save:j,load:G}}function j(e){return{internalIdToId:e.internalIdToId}}function G(e,t){let{internalIdToId:r}=t;e.internalDocumentIDStore.idToInternalId.clear(),e.internalDocumentIDStore.internalIdToId=[];let n=r.length;for(let t=0;t<n;t++){let n=r[t];e.internalDocumentIDStore.idToInternalId.set(n,t+1),e.internalDocumentIDStore.internalIdToId.push(n)}}function J(e,t){if("string"==typeof t){let r=e.idToInternalId.get(t);if(r)return r;let n=e.idToInternalId.size+1;return e.idToInternalId.set(t,n),e.internalIdToId.push(t),n}return t>e.internalIdToId.length?J(e,t.toString()):t}function Y(e,t){if(e.internalIdToId.length<t)throw Error("Invalid internalId ".concat(t));return e.internalIdToId[t-1]}function K(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}function H(e,t){let r=J(e.sharedInternalDocumentStore,t);return e.docs[r]}function $(e,t){let r=t.length,n=Array.from({length:r});for(let o=0;o<r;o++){let r=J(e.sharedInternalDocumentStore,t[o]);n[o]=e.docs[r]}return n}function q(e){return e.docs}function Z(e,t,r,n){return void 0===e.docs[r]&&(e.docs[r]=n,e.count++,!0)}function X(e,t){let r=J(e.sharedInternalDocumentStore,t);return void 0!==e.docs[r]&&(delete e.docs[r],e.count--,!0)}function Q(e){return e.count}function ee(e,t){return{docs:t.docs,count:t.count,sharedInternalDocumentStore:e}}function et(e){return{docs:e.docs,count:e.count}}function er(){return{create:K,get:H,getMultiple:$,getAll:q,store:Z,remove:X,count:Q,load:ee,save:et}}e.s(["count",()=>Q,"create",()=>K,"createDocumentsStore",()=>er,"get",()=>H,"getAll",()=>q,"getMultiple",()=>$,"load",()=>ee,"remove",()=>X,"save",()=>et,"store",()=>Z],614),e.s(["createInternalDocumentIDStore",()=>W,"getDocumentIdFromInternalId",()=>Y,"getInternalDocumentId",()=>J,"load",()=>G,"save",()=>j],97031);let en=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"],eo=["tokenizer","index","documentsStore","sorter"],ei=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function el(e,t,r,n,o){if(e.some(O))return(async()=>{for(let i of e)await i(t,r,n,o)})();for(let i of e)i(t,r,n,o)}function es(e,t,r,n){if(e.some(O))return(async()=>{for(let o of e)await o(t,r,n)})();for(let o of e)o(t,r,n)}e.s(["calculateResultScores",()=>ek,"create",()=>eD,"createIndex",()=>eB,"getSearchableProperties",()=>ex,"getSearchablePropertiesWithTypes",()=>ez,"insert",()=>ew,"insertDocumentScoreParameters",()=>eT,"insertTokenScoreParameters",()=>eO,"insertVector",()=>eA,"load",()=>eC,"remove",()=>eP,"removeDocumentScoreParameters",()=>eN,"removeTokenScoreParameters",()=>e_,"save",()=>eU,"search",()=>eR,"searchByGeoWhereClause",()=>eF,"searchByWhereClause",()=>eM],74002);var ea=e.i(99749);class eu{updateHeight(){this.h=Math.max(eu.getHeight(this.l),eu.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return eu.getHeight(this.l)-eu.getHeight(this.r)}rotateLeft(){let e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){let e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){let t=new eu(e.k,e.v);return t.l=e.l?eu.fromJSON(e.l):null,t.r=e.r?eu.fromJSON(e.r):null,t.h=e.h,t}constructor(e,t){(0,ea._)(this,"k",void 0),(0,ea._)(this,"v",void 0),(0,ea._)(this,"l",null),(0,ea._)(this,"r",null),(0,ea._)(this,"h",1),this.k=e,this.v=new Set(t)}}class ec{insert(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.root=this.insertNode(this.root,e,t,r)}insertMultiple(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let n of t)this.insert(e,n,r)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){let t=new ec;return t.root=e.root?eu.fromJSON(e.root):null,t.insertCount=e.insertCount||0,t}insertNode(e,t,r,n){if(null===e)return new eu(t,[r]);let o=[],i=e,l=null;for(;null!==i;)if(o.push({parent:l,node:i}),t<i.k)if(null===i.l){i.l=new eu(t,[r]),o.push({parent:i,node:i.l});break}else l=i,i=i.l;else if(!(t>i.k))return i.v.add(r),e;else if(null===i.r){i.r=new eu(t,[r]),o.push({parent:i,node:i.r});break}else l=i,i=i.r;let s=!1;this.insertCount++%n==0&&(s=!0);for(let t=o.length-1;t>=0;t--){let{parent:r,node:n}=o[t];if(n.updateHeight(),s){let t=this.rebalanceNode(n);r?r.l===n?r.l=t:r.r===n&&(r.r=t):e=t}}return e}rebalanceNode(e){let t=e.getBalanceFactor();if(t>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();else if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(t<-1){if(e.r&&0>=e.r.getBalanceFactor())return e.rotateLeft();else if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){let t=this.findNodeByKey(e);return t?t.v:null}contains(e){return null!==this.find(e)}getSize(){let e=0,t=[],r=this.root;for(;r||t.length>0;){for(;r;)t.push(r),r=r.l;r=t.pop(),e++,r=r.r}return e}isBalanced(){if(!this.root)return!0;let e=[this.root];for(;e.length>0;){let t=e.pop();if(Math.abs(t.getBalanceFactor())>1)return!1;t.l&&e.push(t.l),t.r&&e.push(t.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,t){let r=this.findNodeByKey(e);r&&(1===r.v.size?this.root=this.removeNode(this.root,e):r.v=new Set([...r.v.values()].filter(e=>e!==t)))}findNodeByKey(e){let t=this.root;for(;t;)if(e<t.k)t=t.l;else{if(!(e>t.k))return t;t=t.r}return null}removeNode(e,t){if(null===e)return null;let r=[],n=e;for(;null!==n&&n.k!==t;)r.push(n),n=t<n.k?n.l:n.r;if(null===n)return e;if(null===n.l||null===n.r){let t=n.l?n.l:n.r;if(0===r.length)e=t;else{let e=r[r.length-1];e.l===n?e.l=t:e.r=t}}else{let e=n,t=n.r;for(;null!==t.l;)e=t,t=t.l;n.k=t.k,n.v=t.v,e.l===t?e.l=t.r:e.r=t.r,n=e}r.push(n);for(let t=r.length-1;t>=0;t--){let n=r[t];n.updateHeight();let o=this.rebalanceNode(n);if(t>0){let e=r[t-1];e.l===n?e.l=o:e.r===n&&(e.r=o)}else e=o}return e}rangeSearch(e,t){let r=new Set,n=[],o=this.root;for(;o||n.length>0;){for(;o;)n.push(o),o=o.l;if((o=n.pop()).k>=e&&o.k<=t&&(r=w(r,o.v)),o.k>t)break;o=o.r}return r}greaterThan(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Set,n=[],o=this.root;for(;o||n.length>0;){for(;o;)n.push(o),o=o.r;if(o=n.pop(),t&&o.k>=e||!t&&o.k>e)r=w(r,o.v);else if(o.k<=e)break;o=o.l}return r}lessThan(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Set,n=[],o=this.root;for(;o||n.length>0;){for(;o;)n.push(o),o=o.l;if(o=n.pop(),t&&o.k<=e||!t&&o.k<e)r=w(r,o.v);else if(o.k>e)break;o=o.r}return r}constructor(e,t){(0,ea._)(this,"root",null),(0,ea._)(this,"insertCount",0),void 0!==e&&void 0!==t&&(this.root=new eu(e,t))}}class ef{insert(e,t){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(t):this.numberToDocumentId.set(e,new Set([t]))}find(e){let t=this.numberToDocumentId.get(e);return t?Array.from(t):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,t){let r=this.numberToDocumentId.get(t);r&&(r.delete(e),0===r.size&&this.numberToDocumentId.delete(t))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(let t of this.numberToDocumentId.values())e+=t.size;return e}filter(e){let t=Object.keys(e);if(1!==t.length)throw Error("Invalid operation");let r=t[0];switch(r){case"eq":{let t=e[r],n=this.numberToDocumentId.get(t);return n?Array.from(n):[]}case"in":{let t=e[r],n=new Set;for(let e of t){let t=this.numberToDocumentId.get(e);if(t)for(let e of t)n.add(e)}return Array.from(n)}case"nin":{let t=new Set(e[r]),n=new Set;for(let[e,r]of this.numberToDocumentId.entries())if(!t.has(e))for(let e of r)n.add(e);return Array.from(n)}default:throw Error("Invalid operation")}}filterArr(e){let t=Object.keys(e);if(1!==t.length)throw Error("Invalid operation");let r=t[0];switch(r){case"containsAll":{let t=e[r].map(e=>{var t;return null!=(t=this.numberToDocumentId.get(e))?t:new Set});if(0===t.length)return[];return Array.from(t.reduce((e,t)=>new Set([...e].filter(e=>t.has(e)))))}case"containsAny":{let t=e[r].map(e=>{var t;return null!=(t=this.numberToDocumentId.get(e))?t:new Set});if(0===t.length)return[];return Array.from(t.reduce((e,t)=>new Set([...e,...t])))}default:throw Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw Error("Invalid Flat Tree JSON");let t=new ef;for(let[r,n]of e.numberToDocumentId)t.numberToDocumentId.set(r,new Set(n));return t}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(e=>{let[t,r]=e;return[t,Array.from(r)]})}}constructor(){(0,ea._)(this,"numberToDocumentId",void 0),this.numberToDocumentId=new Map}}function ed(e,t,r){if(r<0)return -1;if(e===t)return 0;let n=e.length,o=t.length;if(0===n)return o<=r?o:-1;if(0===o)return n<=r?n:-1;let i=Math.abs(n-o);if(e.startsWith(t))return i<=r?i:-1;if(t.startsWith(e))return 0;if(i>r)return -1;let l=[];for(let e=0;e<=n;e++){l[e]=[e];for(let t=1;t<=o;t++)l[e][t]=0===e?t:0}for(let i=1;i<=n;i++){let n=1/0;for(let r=1;r<=o;r++)e[i-1]===t[r-1]?l[i][r]=l[i-1][r-1]:l[i][r]=Math.min(l[i-1][r]+1,l[i][r-1]+1,l[i-1][r-1]+1),n=Math.min(n,l[i][r]);if(n>r)return -1}return l[n][o]<=r?l[n][o]:-1}function eh(e,t,r){let n=ed(e,t,r);return{distance:n,isBounded:n>=0}}function ep(e,t,r){let n=ed(e,t,r);return{distance:n,isBounded:n>=0}}class eg{updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,t,r,n){let o=[this];for(;o.length>0;){let i=o.pop();if(i.e){let{w:o,d:l}=i;if(r&&o!==t)continue;if(null!==m(e,o))if(n){if(!(Math.abs(t.length-o.length)<=n)||!ep(t,o,n).isBounded)continue;e[o]=[]}else e[o]=[];if(null!=m(e,o)&&l.size>0){let t=e[o];for(let e of l)t.includes(e)||t.push(e)}}i.c.size>0&&o.push(...i.c.values())}return e}insert(e,t){let r=this,n=0,o=e.length;for(;n<o;){let i=e[n],l=r.c.get(i);if(l){let i=l.s,s=i.length,a=0;for(;a<s&&n+a<o&&i[a]===e[n+a];)a++;if(a===s){if(r=l,(n+=a)===o){l.e||(l.e=!0),l.addDocument(t);return}continue}let u=i.slice(0,a),c=i.slice(a),f=e.slice(n+a),d=new eg(u[0],u,!1);if(r.c.set(u[0],d),d.updateParent(r),l.s=c,l.k=c[0],d.c.set(c[0],l),l.updateParent(d),f){let e=new eg(f[0],f,!0);e.addDocument(t),d.c.set(f[0],e),e.updateParent(d)}else d.e=!0,d.addDocument(t);return}{let o=new eg(i,e.slice(n),!0);o.addDocument(t),r.c.set(i,o),o.updateParent(r);return}}r.e||(r.e=!0),r.addDocument(t)}_findLevenshtein(e,t,r,n,o){let i=[{node:this,index:t,tolerance:r}];for(;i.length>0;){let{node:t,index:r,tolerance:l}=i.pop();if(t.w.startsWith(e)){t.findAllWords(o,e,!1,0);continue}if(l<0)continue;if(t.e){let{w:r,d:i}=t;if(r&&(ep(e,r,n).isBounded&&(o[r]=[]),void 0!==m(o,r)&&i.size>0)){let e=new Set(o[r]);for(let t of i)e.add(t);o[r]=Array.from(e)}}if(r>=e.length)continue;let s=e[r];if(t.c.has(s)){let e=t.c.get(s);i.push({node:e,index:r+1,tolerance:l})}for(let[e,n]of(i.push({node:t,index:r+1,tolerance:l-1}),t.c))i.push({node:n,index:r,tolerance:l-1}),e!==s&&i.push({node:n,index:r+1,tolerance:l-1})}}find(e){let{term:t,exact:r,tolerance:n}=e;if(n&&!r){let e={};return this._findLevenshtein(t,0,n,n,e),e}{let e=this,o=0,i=t.length;for(;o<i;){let l=t[o],s=e.c.get(l);if(!s)return{};{let l=s.s,a=l.length,u=0;for(;u<a&&o+u<i&&l[u]===t[o+u];)u++;if(u===a)e=s,o+=u;else{if(o+u!==i||u!==i-o||r)return{};let e={};return s.findAllWords(e,t,r,n),e}}}let l={};return e.findAllWords(l,t,r,n),l}}contains(e){let t=this,r=0,n=e.length;for(;r<n;){let o=e[r],i=t.c.get(o);if(!i)return!1;{let o=i.s,l=o.length,s=0;for(;s<l&&r+s<n&&o[s]===e[r+s];)s++;if(s<l)return!1;r+=l,t=i}}return!0}removeWord(e){if(!e)return!1;let t=this,r=e.length,n=[];for(let o=0;o<r;o++){let r=e[o];if(!t.c.has(r))return!1;{let e=t.c.get(r);n.push({parent:t,character:r}),o+=e.s.length-1,t=e}}for(t.d.clear(),t.e=!1;n.length>0&&0===t.c.size&&!t.e&&0===t.d.size;){let{parent:e,character:r}=n.pop();e.c.delete(r),t=e}return!0}removeDocumentByWord(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(!e)return!0;let n=this,o=e.length;for(let i=0;i<o;i++){let o=e[i];if(!n.c.has(o))return!1;{let l=n.c.get(o);i+=l.s.length-1,n=l,r&&n.w!==e||n.removeDocument(t)}}return!0}static getCommonPrefix(e,t){let r=Math.min(e.length,t.length),n=0;for(;n<r&&e.charCodeAt(n)===t.charCodeAt(n);)n++;return e.slice(0,n)}toJSON(){var e,t;return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:null==(e=Array.from(null==(t=this.c)?void 0:t.entries()))?void 0:e.map(e=>{let[t,r]=e;return[t,r.toJSON()]})}}static fromJSON(e){var t;let r=new eg(e.k,e.s,e.e);return r.w=e.w,r.d=new Set(e.d),r.c=new Map(null==e||null==(t=e.c)?void 0:t.map(e=>{let[t,r]=e;return[t,eg.fromJSON(r)]})),r}constructor(e,t,r){(0,ea._)(this,"k",void 0),(0,ea._)(this,"s",void 0),(0,ea._)(this,"c",new Map),(0,ea._)(this,"d",new Set),(0,ea._)(this,"e",void 0),(0,ea._)(this,"w",""),this.k=e,this.s=t,this.e=r}}class em extends eg{static fromJSON(e){var t;let r=new em;return r.w=e.w,r.s=e.s,r.e=e.e,r.k=e.k,r.d=new Set(e.d),r.c=new Map(null==(t=e.c)?void 0:t.map(e=>{let[t,r]=e;return[t,eg.fromJSON(r)]})),r}toJSON(){return super.toJSON()}constructor(){super("","",!1)}}class ey{toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new ey(e.point,e.docIDs);return r.parent=t,e.left&&(r.left=ey.fromJSON(e.left,r)),e.right&&(r.right=ey.fromJSON(e.right,r)),r}constructor(e,t){(0,ea._)(this,"point",void 0),(0,ea._)(this,"docIDs",void 0),(0,ea._)(this,"left",void 0),(0,ea._)(this,"right",void 0),(0,ea._)(this,"parent",void 0),this.point=e,this.docIDs=new Set(t),this.left=null,this.right=null,this.parent=null}}class ev{getPointKey(e){return"".concat(e.lon,",").concat(e.lat)}insert(e,t){let r=this.getPointKey(e),n=this.nodeMap.get(r);if(n)return void t.forEach(e=>n.docIDs.add(e));let o=new ey(e,t);if(this.nodeMap.set(r,o),null==this.root){this.root=o;return}let i=this.root,l=0;for(;;){if(0==l%2)if(e.lon<i.point.lon){if(null==i.left){i.left=o,o.parent=i;return}i=i.left}else{if(null==i.right){i.right=o,o.parent=i;return}i=i.right}else if(e.lat<i.point.lat){if(null==i.left){i.left=o,o.parent=i;return}i=i.left}else{if(null==i.right){i.right=o,o.parent=i;return}i=i.right}l++}}contains(e){let t=this.getPointKey(e);return this.nodeMap.has(t)}getDocIDsByCoordinates(e){let t=this.getPointKey(e),r=this.nodeMap.get(t);return r?Array.from(r.docIDs):null}removeDocByID(e,t){let r=this.getPointKey(e),n=this.nodeMap.get(r);n&&(n.docIDs.delete(t),0===n.docIDs.size&&(this.nodeMap.delete(r),this.deleteNode(n)))}deleteNode(e){let t=e.parent,r=e.left?e.left:e.right;r&&(r.parent=t),t?t.left===e?t.left=r:t.right===e&&(t.right=r):(this.root=r,this.root&&(this.root.parent=null))}searchByRadius(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"asc",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=o?ev.vincentyDistance:ev.haversineDistance,l=[{node:this.root,depth:0}],s=[];for(;l.length>0;){let{node:n,depth:o}=l.pop();if(null==n)continue;let a=i(e,n.point);(r?a<=t:a>t)&&s.push({point:n.point,docIDs:Array.from(n.docIDs)}),null!=n.left&&l.push({node:n.left,depth:o+1}),null!=n.right&&l.push({node:n.right,depth:o+1})}return n&&s.sort((t,r)=>{let o=i(e,t.point),l=i(e,r.point);return"asc"===n.toLowerCase()?o-l:l-o}),s}searchByPolygon(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[{node:this.root,depth:0}],i=[];for(;o.length>0;){let{node:r,depth:n}=o.pop();if(null==r)continue;null!=r.left&&o.push({node:r.left,depth:n+1}),null!=r.right&&o.push({node:r.right,depth:n+1});let l=ev.isPointInPolygon(e,r.point);(l&&t||!l&&!t)&&i.push({point:r.point,docIDs:Array.from(r.docIDs)})}let l=ev.calculatePolygonCentroid(e);if(r){let e=n?ev.vincentyDistance:ev.haversineDistance;i.sort((t,n)=>{let o=e(l,t.point),i=e(l,n.point);return"asc"===r.toLowerCase()?o-i:i-o})}return i}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){let t=new ev;return e.root&&(t.root=ey.fromJSON(e.root),t.buildNodeMap(t.root)),t}buildNodeMap(e){if(null==e)return;let t=this.getPointKey(e.point);this.nodeMap.set(t,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let t=0,r=0,n=0,o=e.length;for(let i=0,l=o-1;i<o;l=i++){let o=e[i].lon,s=e[i].lat,a=e[l].lon,u=e[l].lat,c=o*u-a*s;t+=c,r+=(o+a)*c,n+=(s+u)*c}let i=6*(t/=2);return{lon:r/=i,lat:n/=i}}static isPointInPolygon(e,t){let r=!1,n=t.lon,o=t.lat,i=e.length;for(let t=0,l=i-1;t<i;l=t++){let i=e[t].lon,s=e[t].lat,a=e[l].lon,u=e[l].lat;s>o!=u>o&&n<(a-i)*(o-s)/(u-s)+i&&(r=!r)}return r}static haversineDistance(e,t){let r=Math.PI/180,n=e.lat*r,o=t.lat*r,i=(t.lat-e.lat)*r,l=(t.lon-e.lon)*r,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(o)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3}static vincentyDistance(e,t){let r,n,o,i,l,s,a,u=1/298.257223563,c=(1-1/298.257223563)*6378137,f=Math.PI/180,d=e.lat*f,h=t.lat*f,p=(t.lon-e.lon)*f,g=Math.atan((1-u)*Math.tan(d)),m=Math.atan((1-u)*Math.tan(h)),y=Math.sin(g),v=Math.cos(g),S=Math.sin(m),b=Math.cos(m),I=p,T=1e3;do{let e=Math.sin(I),t=Math.cos(I);if(0===(n=Math.sqrt(b*e*(b*e)+(v*S-y*b*t)*(v*S-y*b*t))))return 0;i=Math.atan2(n,o=y*S+v*b*t),isNaN(a=o-2*y*S/(s=1-(l=v*b*e/n)*l))&&(a=0);let c=u/16*s*(4+u*(4-3*s));r=I,I=p+(1-c)*u*l*(i+c*n*(a+c*o*(-1+2*a*a)))}while(Math.abs(I-r)>1e-12&&--T>0)if(0===T)return NaN;let O=s*(0x24ffb2985f71-c*c)/(c*c),N=1+O/16384*(4096+O*(-768+O*(320-175*O))),_=O/1024*(256+O*(-128+O*(74-47*O)));return c*N*(i-_*n*(a+_/4*(o*(-1+2*a*a)-_/6*a*(-3+4*n*n)*(-3+4*a*a))))}constructor(){(0,ea._)(this,"root",void 0),(0,ea._)(this,"nodeMap",void 0),this.root=null,this.nodeMap=new Map}}class eS{insert(e,t){t?this.true.add(e):this.false.add(e)}delete(e,t){t?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){let t=new eS;return t.true=new Set(e.true),t.false=new Set(e.false),t}constructor(){(0,ea._)(this,"true",void 0),(0,ea._)(this,"false",void 0),this.true=new Set,this.false=new Set}}class eb{add(e,t){t instanceof Float32Array||(t=new Float32Array(t));let r=eI(t,this.size);this.vectors.set(e,[r,t])}remove(e){this.vectors.delete(e)}find(e,t,r){return e instanceof Float32Array||(e=new Float32Array(e)),function(e,t,r,n,o){let i=eI(e,n),l=[];for(let s of t||r.keys()){let t=r.get(s);if(!t)continue;let a=t[0],u=t[1],c=0;for(let t=0;t<n;t++)c+=e[t]*u[t];let f=c/(i*a);f>=o&&l.push([s,f])}return l}(e,r,this.vectors,this.size,t)}toJSON(){let e=[];for(let[t,[r,n]]of this.vectors)e.push([t,[r,Array.from(n)]]);return{size:this.size,vectors:e}}static fromJSON(e){let t=new eb(e.size);for(let[r,[n,o]]of e.vectors)t.vectors.set(r,[n,new Float32Array(o)]);return t}constructor(e){(0,ea._)(this,"size",void 0),(0,ea._)(this,"vectors",new Map),this.size=e}}function eI(e,t){let r=0;for(let n=0;n<t;n++)r+=e[n]*e[n];return Math.sqrt(r)}function eT(e,t,r,n,o){var i;let l=J(e.sharedInternalDocumentStore,r);e.avgFieldLength[t]=((null!=(i=e.avgFieldLength[t])?i:0)*(o-1)+n.length)/o,e.fieldLengths[t][l]=n.length,e.frequencies[t][l]={}}function eO(e,t,r,n,o){var i;let l=0;for(let e of n)e===o&&l++;let s=J(e.sharedInternalDocumentStore,r),a=l/n.length;e.frequencies[t][s][o]=a,o in e.tokenOccurrences[t]||(e.tokenOccurrences[t][o]=0),e.tokenOccurrences[t][o]=(null!=(i=e.tokenOccurrences[t][o])?i:0)+1}function eN(e,t,r,n){let o=J(e.sharedInternalDocumentStore,r);n>1?e.avgFieldLength[t]=(e.avgFieldLength[t]*n-e.fieldLengths[t][o])/(n-1):e.avgFieldLength[t]=void 0,e.fieldLengths[t][o]=void 0,e.frequencies[t][o]=void 0}function e_(e,t,r){e.tokenOccurrences[t][r]--}function eD(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";for(let[i,l]of(n||(n={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(r))){let r="".concat(o).concat(o?".":"").concat(i);if("object"==typeof l&&!Array.isArray(l)){eD(e,t,l,n,r);continue}if(B(l))n.searchableProperties.push(r),n.searchablePropertiesWithTypes[r]=l,n.vectorIndexes[r]={type:"Vector",node:new eb(F(l)),isArray:!1};else{let e=/\[/.test(l);switch(l){case"boolean":case"boolean[]":n.indexes[r]={type:"Bool",node:new eS,isArray:e};break;case"number":case"number[]":n.indexes[r]={type:"AVL",node:new ec(0,[]),isArray:e};break;case"string":case"string[]":n.indexes[r]={type:"Radix",node:new em,isArray:e},n.avgFieldLength[r]=0,n.frequencies[r]={},n.tokenOccurrences[r]={},n.fieldLengths[r]={};break;case"enum":case"enum[]":n.indexes[r]={type:"Flat",node:new ef,isArray:e};break;case"geopoint":n.indexes[r]={type:"BKD",node:new ev,isArray:e};break;default:throw k("INVALID_SCHEMA_TYPE",Array.isArray(l)?"array":l,r)}n.searchableProperties.push(r),n.searchablePropertiesWithTypes[r]=l}}return n}function ew(e,t,r,n,o,i,l,s,a,u,c){if(B(l))return eA(t,r,i,n,o);let f=n=>{let{type:i,node:l}=t.indexes[r];switch(i){case"Bool":l[n?"true":"false"].add(o);break;case"AVL":{var f;let e=null!=(f=null==c?void 0:c.avlRebalanceThreshold)?f:1;l.insert(n,o,e);break}case"Radix":{let i=a.tokenize(n,s,r,!1);for(let n of(e.insertDocumentScoreParameters(t,r,o,i,u),i))e.insertTokenScoreParameters(t,r,o,i,n),l.insert(n,o);break}case"Flat":l.insert(n,o);break;case"BKD":l.insert(n,[o])}};if(!L(l))return f(i);let d=i.length;for(let e=0;e<d;e++)f(i[e])}function eA(e,t,r,n,o){e.vectorIndexes[t].node.add(o,r)}function eE(e,t,r,n,o,i,l,s,a,u){if(B(l))return t.vectorIndexes[r].node.remove(o),!0;let{type:c,node:f}=t.indexes[r];switch(c){case"AVL":return f.removeDocument(i,o),!0;case"Bool":return f[i?"true":"false"].delete(o),!0;case"Radix":{let l=a.tokenize(i,s,r);for(let i of(e.removeDocumentScoreParameters(t,r,n,u),l))e.removeTokenScoreParameters(t,r,i),f.removeDocumentByWord(i,o);return!0}case"Flat":return f.removeDocument(o,i),!0;case"BKD":return f.removeDocByID(i,o),!1}}function eP(e,t,r,n,o,i,l,s,a,u){if(!L(l))return eE(e,t,r,n,o,i,l,s,a,u);let c=C[l],f=i.length;for(let l=0;l<f;l++)eE(e,t,r,n,o,i[l],c,s,a,u);return!0}function ek(e,t,r,n,o,i,l,s,a,u){var c,f,d;let h=Array.from(n),p=e.avgFieldLength[t],g=e.fieldLengths[t],m=e.tokenOccurrences[t],y=e.frequencies[t],v="number"==typeof m[r]&&null!=(c=m[r])?c:0,S=h.length;for(let e=0;e<S;e++){let n=h[e];if(a&&!a.has(n))continue;u.has(n)||u.set(n,new Map);let c=u.get(n);c.set(t,(c.get(t)||0)+1);let m=function(e,t,r,n,o,i){let{k:l,b:s,d:a}=i;return Math.log(1+(r-t+.5)/(t+.5))*(a+e*(l+1))/(e+l*(1-s+s*n/o))}(null!=(d=null==y||null==(f=y[n])?void 0:f[r])?d:0,v,o,g[n],p,i);l.has(n)?l.set(n,l.get(n)+m*s):l.set(n,m*s)}}function eR(e,t,r,n,o,i,l,s,a,u,c){let f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=r.tokenize(t,n),h=d.length||1,p=new Map,g=new Map,m=new Map;for(let r of o){var y;if(!(r in e.indexes))continue;let n=e.indexes[r],{type:o}=n;if("Radix"!==o)throw k("WRONG_SEARCH_PROPERTY_TYPE",r);let f=null!=(y=s[r])?y:1;if(f<=0)throw k("INVALID_BOOST_VALUE",f);0!==d.length||t||d.push("");let h=d.length;for(let t=0;t<h;t++){let o=d[t],s=n.node.find({term:o,exact:i,tolerance:l}),h=Object.keys(s);h.length>0&&g.set(o,!0);let y=h.length;for(let t=0;t<y;t++){let n=h[t],o=s[n];ek(e,r,n,o,u,a,m,f,c,p)}}}let v=Array.from(m.entries()).map(e=>{let[t,r]=e;return[t,r]}).sort((e,t)=>t[1]-e[1]);if(0===v.length)return[];if(1===f)return v;if(0===f){if(1===h)return v;for(let e of d)if(!g.get(e))return[];return v.filter(e=>{let[t]=e,r=p.get(t);return!!r&&Array.from(r.values()).some(e=>e===h)})}let S=v.filter(e=>{let[t]=e,r=p.get(t);return!!r&&Array.from(r.values()).some(e=>e===h)});if(S.length>0){let e=v.filter(e=>{let[t]=e;return!S.some(e=>{let[r]=e;return r===t})}),t=Math.ceil(e.length*f);return[...S,...e.slice(0,t)]}return v}function eM(e,t,r,n){if("and"in r&&r.and&&Array.isArray(r.and)){let o=r.and;return 0===o.length?new Set:_(...o.map(r=>eM(e,t,r,n)))}if("or"in r&&r.or&&Array.isArray(r.or)){let o=r.or;return 0===o.length?new Set:o.map(r=>eM(e,t,r,n)).reduce((e,t)=>w(e,t),new Set)}if("not"in r&&r.not){let o=r.not,i=new Set,l=e.sharedInternalDocumentStore;for(let e=1;e<=l.internalIdToId.length;e++)i.add(e);return A(i,eM(e,t,o,n))}let o=Object.keys(r),i=o.reduce((e,t)=>({[t]:new Set,...e}),{});for(let l of o){let o=r[l];if(void 0===e.indexes[l])throw k("UNKNOWN_FILTER_PROPERTY",l);let{node:s,type:a,isArray:u}=e.indexes[l];if("Bool"===a){let e=o?s.true:s.false;i[l]=w(i[l],e);continue}if("BKD"===a){let e;if("radius"in o)e="radius";else if("polygon"in o)e="polygon";else throw Error("Invalid operation ".concat(o));if("radius"===e){let{value:t,coordinates:r,unit:n="m",inside:a=!0,highPrecision:u=!1}=o[e],c=I(t,n),f=s.searchByRadius(r,c,a,void 0,u);i[l]=eL(i[l],f)}else{let{coordinates:t,inside:r=!0,highPrecision:n=!1}=o[e],a=s.searchByPolygon(t,r,void 0,n);i[l]=eL(i[l],a)}continue}if("Radix"===a&&("string"==typeof o||Array.isArray(o))){for(let e of[o].flat())for(let r of t.tokenize(e,n,l)){let e=s.find({term:r,exact:!0});i[l]=function(e,t){e||(e=new Set);let r=Object.keys(t),n=r.length;for(let o=0;o<n;o++){let n=t[r[o]],i=n.length;for(let t=0;t<i;t++)e.add(n[t])}return e}(i[l],e)}continue}let c=Object.keys(o);if(c.length>1)throw k("INVALID_FILTER_OPERATION",c.length);if("Flat"===a){let e=new Set(u?s.filterArr(o):s.filter(o));i[l]=w(i[l],e);continue}if("AVL"===a){let e,t=c[0],r=o[t];switch(t){case"gt":e=s.greaterThan(r,!1);break;case"gte":e=s.greaterThan(r,!0);break;case"lt":e=s.lessThan(r,!1);break;case"lte":e=s.lessThan(r,!0);break;case"eq":{let t=s.find(r);e=null!=t?t:new Set;break}case"between":{let[t,n]=r;e=s.rangeSearch(t,n);break}default:throw k("INVALID_FILTER_OPERATION",t)}i[l]=w(i[l],e)}}return _(...Object.values(i))}function ex(e){return e.searchableProperties}function ez(e){return e.searchablePropertiesWithTypes}function eC(e,t){let{indexes:r,vectorIndexes:n,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:l,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}=t,c={},f={};for(let e of Object.keys(r)){let{node:t,type:n,isArray:o}=r[e];switch(n){case"Radix":c[e]={type:"Radix",node:em.fromJSON(t),isArray:o};break;case"Flat":c[e]={type:"Flat",node:ef.fromJSON(t),isArray:o};break;case"AVL":c[e]={type:"AVL",node:ec.fromJSON(t),isArray:o};break;case"BKD":c[e]={type:"BKD",node:ev.fromJSON(t),isArray:o};break;case"Bool":c[e]={type:"Bool",node:eS.fromJSON(t),isArray:o};break;default:c[e]=r[e]}}for(let e of Object.keys(n))f[e]={type:"Vector",isArray:!1,node:eb.fromJSON(n[e])};return{sharedInternalDocumentStore:e,indexes:c,vectorIndexes:f,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:l,tokenOccurrences:s,avgFieldLength:a,fieldLengths:u}}function eU(e){let{indexes:t,vectorIndexes:r,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:l,avgFieldLength:s,fieldLengths:a}=e,u={};for(let e of Object.keys(r))u[e]=r[e].node.toJSON();let c={};for(let e of Object.keys(t)){let{type:r,node:n,isArray:o}=t[e];"Flat"===r||"Radix"===r||"AVL"===r||"BKD"===r||"Bool"===r?c[e]={type:r,node:n.toJSON(),isArray:o}:(c[e]=t[e],c[e].node=c[e].node.toJSON())}return{indexes:c,vectorIndexes:u,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:l,avgFieldLength:s,fieldLengths:a}}function eB(){return{create:eD,insert:ew,remove:eP,insertDocumentScoreParameters:eT,insertTokenScoreParameters:eO,removeDocumentScoreParameters:eN,removeTokenScoreParameters:e_,calculateResultScores:ek,search:eR,searchByWhereClause:eM,getSearchableProperties:ex,getSearchablePropertiesWithTypes:ez,load:eC,save:eU}}function eL(e,t){e||(e=new Set);let r=t.length;for(let n=0;n<r;n++){let r=t[n].docIDs,o=r.length;for(let t=0;t<o;t++)e.add(r[t])}return e}function eV(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=r?ev.vincentyDistance:ev.haversineDistance,o=[],i=[];for(let{point:r}of e)i.push(n(t,r));let l=Math.max(...i),s=0;for(let{docIDs:t}of e){let e=l-i[s]+1;for(let r of t)o.push([r,e]);s++}return o.sort((e,t)=>t[1]-e[1]),o}function eF(e,t){let r,n=function(e,t){let r=Object.keys(e);if(1!==r.length)return{isGeoOnly:!1};let n=r[0],o=e[n];if(void 0===t.indexes[n])return{isGeoOnly:!1};let{type:i}=t.indexes[n];return"BKD"===i&&o&&("radius"in o||"polygon"in o)?{isGeoOnly:!0,geoProperty:n,geoOperation:o}:{isGeoOnly:!1}}(t,e);if(!n.isGeoOnly||!n.geoProperty||!n.geoOperation)return null;let{node:o}=e.indexes[n.geoProperty],i=n.geoOperation;if("radius"in i){let{value:e,coordinates:t,unit:n="m",inside:l=!0,highPrecision:s=!1}=i.radius,a=I(e,n);return eV(r=o.searchByRadius(t,a,l,"asc",s),t,s)}if("polygon"in i){let{coordinates:e,inside:t=!0,highPrecision:n=!1}=i.polygon;return eV(r=o.searchByPolygon(e,t,"asc",n),ev.calculatePolygonCentroid(e),n)}return null}function eW(e,t,r,n){return(null==n?void 0:n.enabled)===!1?{disabled:!0}:function e(t,r,n,o,i){let l={language:t.tokenizer.language,sharedInternalDocumentStore:r,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[s,a]of Object.entries(n)){let n="".concat(i).concat(i?".":"").concat(s);if(!o.includes(n)){if("object"==typeof a&&!Array.isArray(a)){let i=e(t,r,a,o,n);c(l.sortableProperties,i.sortableProperties),l.sorts={...l.sorts,...i.sorts},l.sortablePropertiesWithTypes={...l.sortablePropertiesWithTypes,...i.sortablePropertiesWithTypes};continue}if(!B(a))switch(a){case"boolean":case"number":case"string":l.sortableProperties.push(n),l.sortablePropertiesWithTypes[n]=a,l.sorts[n]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:a};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw k("INVALID_SORT_SCHEMA_TYPE",Array.isArray(a)?"array":a,n)}}}return l}(e,t,r,(n||{}).unsortableProperties||[],"")}function ej(e,t,r,n){if(!e.enabled)return;e.isSorted=!1;let o=J(e.sharedInternalDocumentStore,r),i=e.sorts[t];i.orderedDocsToRemove.has(o)&&eH(e,t),i.docs.set(o,i.orderedDocs.length),i.orderedDocs.push([o,n])}function eG(e){if(!e.isSorted&&e.enabled){for(let t of Object.keys(e.sorts))!function(e,t){let r,n=e.sorts[t];switch(n.type){case"string":r=eJ.bind(null,e.language);break;case"number":r=eY.bind(null);break;case"boolean":r=eK.bind(null)}n.orderedDocs.sort(r);let o=n.orderedDocs.length;for(let e=0;e<o;e++){let t=n.orderedDocs[e][0];n.docs.set(t,e)}}(e,t);e.isSorted=!0}}function eJ(e,r,o){return r[1].localeCompare(o[1],void 0!==e&&n.includes(e)?t[e]:void 0)}function eY(e,t){return e[1]-t[1]}function eK(e,t){return t[1]?-1:1}function eH(e,t){let r=e.sorts[t];r.orderedDocsToRemove.size&&(r.orderedDocs=r.orderedDocs.filter(e=>!r.orderedDocsToRemove.has(e[0])),r.orderedDocsToRemove.clear())}function e$(e,t,r){if(!e.enabled)return;let n=e.sorts[t],o=J(e.sharedInternalDocumentStore,r);n.docs.get(o)&&(n.docs.delete(o),n.orderedDocsToRemove.set(o,!0))}function eq(e,t,r){if(!e.enabled)throw k("SORT_DISABLED");let n=r.property,o="DESC"===r.order,i=e.sorts[n];if(!i)throw k("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",n,e.sortableProperties.join(", "));return eH(e,n),eG(e),t.sort((t,r)=>{let n=i.docs.get(J(e.sharedInternalDocumentStore,t[0])),l=i.docs.get(J(e.sharedInternalDocumentStore,r[0])),s=void 0!==n,a=void 0!==l;return s||a?s?a?o?l-n:n-l:-1:1:0}),t}function eZ(e){return e.enabled?e.sortableProperties:[]}function eX(e){return e.enabled?e.sortablePropertiesWithTypes:{}}function eQ(e,t){if(!t.enabled)return{enabled:!1};let r=Object.keys(t.sorts).reduce((e,r)=>{let{docs:n,orderedDocs:o,type:i}=t.sorts[r];return e[r]={docs:new Map(Object.entries(n).map(e=>{let[t,r]=e;return[+t,r]})),orderedDocsToRemove:new Map,orderedDocs:o,type:i},e},{});return{sharedInternalDocumentStore:e,language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:r,enabled:!0,isSorted:t.isSorted}}function e0(e){if(!e.enabled)return{enabled:!1};for(let t of Object.keys(e.sorts))eH(e,t);eG(e);let t=Object.keys(e.sorts).reduce((t,r)=>{let{docs:n,orderedDocs:o,type:i}=e.sorts[r];return t[r]={docs:Object.fromEntries(n.entries()),orderedDocs:o,type:i},t},{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}function e1(){return{create:eW,insert:ej,remove:e$,save:e0,load:eQ,sortBy:eq,getSortableProperties:eZ,getSortablePropertiesWithTypes:eX}}e.s(["createSorter",()=>e1,"load",()=>eQ,"save",()=>e0],76085),e.s(["createTokenizer",()=>ti,"normalizeToken",()=>tn],62975);let e9=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115],e7={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e2={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},e6="[aeiouy]",e3="[^aeiou][^aeiouy]*",e5=e6+"[aeiou]*",e8="^("+e3+")?"+e5+e3,e4="^("+e3+")?"+e5+e3+"("+e5+")?$",te="^("+e3+")?"+e5+e3+e5+e3,tt="^("+e3+")?"+e6;function tr(e){let t,r,n,o,i,l;if(e.length<3)return e;let s=e.substring(0,1);if("y"==s&&(e=s.toUpperCase()+e.substring(1)),o=/^(.+?)([^s])s$/,(n=/^(.+?)(ss|i)es$/).test(e)?e=e.replace(n,"$1$2"):o.test(e)&&(e=e.replace(o,"$1$2")),o=/^(.+?)(ed|ing)$/,(n=/^(.+?)eed$/).test(e)){let t=n.exec(e);(n=new RegExp(e8)).test(t[1])&&(n=/.$/,e=e.replace(n,""))}else o.test(e)&&(t=o.exec(e)[1],(o=new RegExp(tt)).test(t)&&(e=t,o=/(at|bl|iz)$/,i=RegExp("([^aeiouylsz])\\1$"),l=RegExp("^"+e3+e6+"[^aeiouwxy]$"),o.test(e)?e+="e":i.test(e)?(n=/.$/,e=e.replace(n,"")):l.test(e)&&(e+="e")));if((n=/^(.+?)y$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(tt),t&&n.test(t)&&(e=t+"i")}if((n=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(e)){let o=n.exec(e);t=null==o?void 0:o[1],r=null==o?void 0:o[2],n=new RegExp(e8),t&&n.test(t)&&(e=t+e7[r])}if((n=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(e)){let o=n.exec(e);t=null==o?void 0:o[1],r=null==o?void 0:o[2],n=new RegExp(e8),t&&n.test(t)&&(e=t+e2[r])}if(o=/^(.+?)(s|t)(ion)$/,(n=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(te),t&&n.test(t)&&(e=t)}else if(o.test(e)){var a,u;let r=o.exec(e);t=null!=(u=null!=(a=null==r?void 0:r[1])?a:""+(null==r?void 0:r[2]))?u:"",(o=new RegExp(te)).test(t)&&(e=t)}if((n=/^(.+?)e$/).test(e)){let r=n.exec(e);t=null==r?void 0:r[1],n=new RegExp(te),o=new RegExp(e4),i=RegExp("^"+e3+e6+"[^aeiouwxy]$"),t&&(n.test(t)||o.test(t)&&!i.test(t))&&(e=t)}return n=/ll$/,o=new RegExp(te),n.test(e)&&o.test(e)&&(n=/.$/,e=e.replace(n,"")),"y"==s&&(e=s.toLowerCase()+e.substring(1)),e}function tn(e,t){var r;let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o="".concat(this.language,":").concat(e,":").concat(t);return n&&this.normalizationCache.has(o)?this.normalizationCache.get(o):(null==(r=this.stopWords)?void 0:r.includes(t))?(n&&this.normalizationCache.set(o,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){let t=[];for(let n=0;n<e.length;n++){var r;t[n]=(r=e.charCodeAt(n))<192||r>383?r:e9[r-192]||r}return String.fromCharCode(...t)}(t),n&&this.normalizationCache.set(o,t),t)}function to(e,t,n){let o,i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(t&&t!==this.language)throw k("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];let l=this.normalizeToken.bind(this,null!=n?n:"");if(n&&this.tokenizeSkipProperties.has(n))o=[l(e,i)];else{let t=r[this.language];o=e.toLowerCase().split(t).map(e=>l(e,i)).filter(Boolean)}let s=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(o);return this.allowDuplicates?s:Array.from(new Set(s))}function ti(){let e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r.language){if(!n.includes(r.language))throw k("LANGUAGE_NOT_SUPPORTED",r.language)}else r.language="english";if(r.stemming||r.stemmer&&!("stemming"in r))if(r.stemmer){if("function"!=typeof r.stemmer)throw k("INVALID_STEMMER_FUNCTION_TYPE");e=r.stemmer}else if("english"===r.language)e=tr;else throw k("MISSING_STEMMER",r.language);if(!1!==r.stopWords){if(t=[],Array.isArray(r.stopWords))t=r.stopWords;else if("function"==typeof r.stopWords)t=r.stopWords(t);else if(r.stopWords)throw k("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(t))throw k("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let e of t)if("string"!=typeof e)throw k("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let o={tokenize:to,language:r.language,stemmer:e,stemmerSkipProperties:new Set(r.stemmerSkipProperties?[r.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(r.tokenizeSkipProperties?[r.tokenizeSkipProperties].flat():[]),stopWords:t,allowDuplicates:!!r.allowDuplicates,normalizeToken:tn,normalizationCache:new Map};return o.tokenize=to.bind(o),o.normalizeToken=tn,o}function tl(e){let{schema:t,sort:r,language:n,components:o,id:i,plugins:l}=e;for(let e of(o||(o={}),null!=l?l:[])){if(!("getComponents"in e)||"function"!=typeof e.getComponents)continue;let r=e.getComponents(t);for(let t of Object.keys(r))if(o[t])throw k("PLUGIN_COMPONENT_CONFLICT",t,e.name);o={...o,...r}}i||(i=g());let s=o.tokenizer,a=o.index,u=o.documentsStore,c=o.sorter;if(s=s?s.tokenize?s:ti(s):ti({language:null!=n?n:"english"}),o.tokenizer&&n)throw k("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let f=W();a||(a=eB()),c||(c=e1()),u||(u=er());var d,h=o;let p={formatElapsedTime:R,getDocumentIndexId:M,getDocumentProperties:v,validateSchema:x};for(let e of ei)if(h[e]){if("function"!=typeof h[e])throw k("COMPONENT_MUST_BE_FUNCTION",e)}else h[e]=p[e];for(let e of Object.keys(h))if(!eo.includes(e)&&!ei.includes(e))throw k("UNSUPPORTED_COMPONENT",e);let{getDocumentProperties:m,getDocumentIndexId:y,validateSchema:S,formatElapsedTime:b}=o,I={data:{},caches:{},schema:t,tokenizer:s,index:a,sorter:c,documentsStore:u,internalDocumentIDStore:f,getDocumentProperties:m,getDocumentIndexId:y,validateSchema:S,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:b,id:i,plugins:l,version:"{{VERSION}}"};for(let e of(I.data={index:I.index.create(I,f,t),docs:I.documentsStore.create(I,f),sorting:I.sorter.create(I,f,t,r)},en))I[e]=(null!=(d=I[e])?d:[]).concat(function(e,t){var r;let n=[],o=null==(r=e.plugins)?void 0:r.length;if(!o)return n;for(let r=0;r<o;r++)try{let o=e.plugins[r];"function"==typeof o[t]&&n.push(o[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),k("PLUGIN_CRASHED")}return n}(I,e));let T=I.afterCreate;return T&&function(e,t){if(e.some(O))return(async()=>{for(let r of e)await r(t)})();for(let r of e)r(t)}(T,I),I}function ts(e,t){return e.documentsStore.get(e.data.docs,t)}function ta(e){return e.documentsStore.count(e.data.docs)}e.s(["count",()=>ta,"getByID",()=>ts],64191),e.s([],67907);var tu=e.i(614),tc=e.i(74002),tf=e.i(62975),td=e.i(76085),th=e.i(97031);e.s(["formatElapsedTime",()=>R,"getDocumentIndexId",()=>M,"getDocumentProperties",()=>v,"getInnerType",()=>V,"getVectorSize",()=>F,"isArrayType",()=>L,"isGeoPointType",()=>U,"isVectorType",()=>B,"validateSchema",()=>x],35306),e.i(76629),e.s(["fetchDocuments",()=>tE,"fetchDocumentsWithDistinct",()=>tA,"search",()=>tw],89515);let tp="fulltext";function tg(e,t){return e[1]-t[1]}function tm(e,t){return t[1]-e[1]}function ty(e,t,r){let n={},o=t.map(e=>{let[t]=e;return t}),i=e.documentsStore.getMultiple(e.data.docs,o),l=Object.keys(r),s=e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e of l){let t;if("number"===s[e]){let{ranges:n}=r[e],o=n.length,i=Array.from({length:o});for(let e=0;e<o;e++){let t=n[e];i[e]=["".concat(t.from,"-").concat(t.to),0]}t=Object.fromEntries(i)}n[e]={count:0,values:null!=t?t:{}}}let a=i.length;for(let e=0;e<a;e++){let t=i[e];for(let e of l){let o=e.includes(".")?S(t,e):t[e],i=s[e],l=n[e].values;switch(i){case"number":tv(r[e].ranges,l)(o);break;case"number[]":{let t=new Set,n=tv(r[e].ranges,l,t);for(let e of o)n(e);break}case"boolean":case"enum":case"string":tS(l,i)(o);break;case"boolean[]":case"enum[]":case"string[]":{let e=tS(l,"boolean[]"===i?"boolean":"string",new Set);for(let t of o)e(t);break}default:throw k("FACET_NOT_SUPPORTED",i)}}}for(let e of l){let t=n[e];if(t.count=Object.keys(t.values).length,"string"===s[e]){var u,c;let n=r[e],o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"desc";return"asc"===e.toLowerCase()?tg:tm}(n.sort);t.values=Object.fromEntries(Object.entries(t.values).sort(o).slice(null!=(u=n.offset)?u:0,null!=(c=n.limit)?c:10))}}return n}function tv(e,t,r){return n=>{for(let o of e){let e="".concat(o.from,"-").concat(o.to);(null==r||!r.has(e))&&n>=o.from&&n<=o.to&&(void 0===t[e]?t[e]=1:(t[e]++,null==r||r.add(e)))}}}function tS(e,t,r){let n="boolean"===t?"false":"";return t=>{var o,i;let l=null!=(o=null==t?void 0:t.toString())?o:n;null!=r&&r.has(l)||(e[l]=(null!=(i=e[l])?i:0)+1,null==r||r.add(l))}}let tb={reducer:(e,t,r,n)=>(t[n]=r,t),getInitialValue:e=>Array.from({length:e})},tI=["string","number","boolean"];function tT(e,t,r){let n=r.properties,o=n.length,i=e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e=0;e<o;e++){let t=n[e];if(void 0===i[t])throw k("UNKNOWN_GROUP_BY_PROPERTY",t);if(!tI.includes(i[t]))throw k("INVALID_GROUP_BY_PROPERTY",t,tI.join(", "),i[t])}let l=t.map(t=>{let[r]=t;return Y(e.internalDocumentIDStore,r)}),s=e.documentsStore.getMultiple(e.data.docs,l),a=s.length,u=r.maxResult||Number.MAX_SAFE_INTEGER,f=[],d={};for(let e=0;e<o;e++){let t=n[e],r={property:t,perValue:{}},o=new Set;for(let e=0;e<a;e++){var h;let n=S(s[e],t);if(void 0===n)continue;let i="boolean"!=typeof n?n:""+n,l=null!=(h=r.perValue[i])?h:{indexes:[],count:0};l.count>=u||(l.indexes.push(e),l.count++,r.perValue[i]=l,o.add(n))}f.push(Array.from(o)),d[t]=r}let p=function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r+1===t.length)return t[r].map(e=>[e]);let n=t[r],o=e(t,r+1),i=[];for(let e of n)for(let t of o){let r=[e];c(r,t),i.push(r)}return i}(f),g=p.length,m=[];for(let e=0;e<g;e++){let t=p[e],r=t.length,o={values:[],indexes:[]},i=[];for(let e=0;e<r;e++){let r=t[e],l=n[e];i.push(d[l].perValue["boolean"!=typeof r?r:""+r].indexes),o.values.push(r)}o.indexes=(function(e){if(0===e.length)return[];if(1===e.length)return e[0];for(let t=1;t<e.length;t++)if(e[t].length<e[0].length){let r=e[0];e[0]=e[t],e[t]=r}let t=new Map;for(let r of e[0])t.set(r,1);for(let r=1;r<e.length;r++){let n=0;for(let o of e[r]){let e=t.get(o);e===r&&(t.set(o,e+1),n++)}if(0===n)return[]}return e[0].filter(r=>{let n=t.get(r);return void 0!==n&&t.set(r,0),n===e.length})})(i).sort((e,t)=>e-t),0!==o.indexes.length&&m.push(o)}let y=m.length,v=Array.from({length:y});for(let e=0;e<y;e++){let n=m[e],o=r.reduce||tb,i=n.indexes.map(e=>({id:l[e],score:t[e][1],document:s[e]})),a=o.reducer.bind(null,n.values),u=o.getInitialValue(n.indexes.length),c=i.reduce(a,u);v[e]={values:n.values,result:c}}return v}function tO(e,t,r){var n;let o,i,{term:l,properties:s}=t,a=e.data.index,u=e.caches.propertiesToSearch;if(!u){let t=e.index.getSearchablePropertiesWithTypes(a);u=(u=e.index.getSearchableProperties(a)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=u}if(s&&"*"!==s){for(let e of s)if(!u.includes(e))throw k("UNKNOWN_INDEX",e,u.join(", "));u=u.filter(e=>s.includes(e))}let c=Object.keys(null!=(n=t.where)?n:{}).length>0;c&&(o=e.index.searchByWhereClause(a,e.tokenizer,t.where,r));let f=void 0!==t.threshold&&null!==t.threshold?t.threshold:1;if(l||s){let n=ta(e);i=e.index.search(a,l||"",e.tokenizer,r,u,t.exact||!1,t.tolerance||0,t.boost||{},function(e){var t,r,n;let o=null!=e?e:{};return o.k=null!=(t=o.k)?t:tN.k,o.b=null!=(r=o.b)?r:tN.b,o.d=null!=(n=o.d)?n:tN.d,o}(t.relevance),n,o,f)}else if(c){let e=eF(a,t.where);i=e||(o?Array.from(o):[]).map(e=>[+e,0])}else i=Object.keys(e.documentsStore.getAll(e.data.docs)).map(e=>[+e,0]);return i}let tN={k:1.2,b:.75,d:.5};function t_(e,t,r){var n,o;let i,l=t.vector;if(l&&(!("value"in l)||!("property"in l)))throw k("INVALID_VECTOR_INPUT",Object.keys(l).join(", "));let s=e.data.index.vectorIndexes[l.property],a=s.node.size;if((null==l?void 0:l.value.length)!==a){if((null==l?void 0:l.property)===void 0||(null==l?void 0:l.value.length)===void 0)throw k("INVALID_INPUT_VECTOR","undefined",a,"undefined");throw k("INVALID_INPUT_VECTOR",l.property,a,l.value.length)}let u=e.data.index;return Object.keys(null!=(n=t.where)?n:{}).length>0&&(i=e.index.searchByWhereClause(u,e.tokenizer,t.where,r)),s.node.find(l.value,null!=(o=t.similarity)?o:.8,i)}function tD(e){return e[1]}function tw(e,t,r){var n;let o=null!=(n=t.mode)?n:tp;if(o===tp)return function(e,t,r){var n,o;let i=p();function l(){let n,o=Object.keys(e.data.index.vectorIndexes),l=t.facets&&Object.keys(t.facets).length>0,{limit:s=10,offset:a=0,distinctOn:u,includeVectors:c=!1}=t,f=!0===t.preflight,d=tO(e,t,r);if(t.sortBy)if("function"==typeof t.sortBy){let r=d.map(e=>{let[t]=e;return t}),n=e.documentsStore.getMultiple(e.data.docs,r).map((e,t)=>[d[t][0],d[t][1],e]);n.sort(t.sortBy),d=n.map(e=>{let[t,r]=e;return[t,r]})}else d=e.sorter.sortBy(e.data.sorting,d,t.sortBy).map(t=>{let[r,n]=t;return[J(e.internalDocumentIDStore,r),n]});else d=d.sort(y);f||(n=u?tA(e,d,a,s,u):tE(e,d,a,s));let h={elapsed:{formatted:"",raw:0},hits:[],count:d.length};return void 0!==n&&(h.hits=n.filter(Boolean),c||T(h,o)),l&&(h.facets=ty(e,d,t.facets)),t.groupBy&&(h.groups=tT(e,d,t.groupBy)),h.elapsed=e.formatElapsedTime(p()-i),h}async function s(){e.beforeSearch&&await es(e.beforeSearch,e,t,r);let n=l();return e.afterSearch&&await el(e.afterSearch,e,t,r,n),n}return(null==(n=e.beforeSearch)?void 0:n.length)||(null==(o=e.afterSearch)?void 0:o.length)?s():l()}(e,t,r);if("vector"===o)return function(e,t){var r,n;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"english",i=p();function l(){var r,n,l;let s=t_(e,t,o).sort(y),a=[];t.facets&&Object.keys(t.facets).length>0&&(a=ty(e,s,t.facets));let u=t.vector.property,c=null!=(r=t.includeVectors)&&r,f=null!=(n=t.limit)?n:10,d=null!=(l=t.offset)?l:0,g=Array.from({length:f});for(let t=0;t<f;t++){let r=s[t+d];if(!r)break;let n=e.data.docs.docs[r[0]];if(n){c||(n[u]=null);let o={id:Y(e.internalDocumentIDStore,r[0]),score:r[1],document:n};g[t]=o}}let m=[];t.groupBy&&(m=tT(e,s,t.groupBy));let v=p()-i;return{count:s.length,hits:g.filter(Boolean),elapsed:{raw:Number(v),formatted:h(v)},...a?{facets:a}:{},...m?{groups:m}:{}}}async function s(){e.beforeSearch&&await es(e.beforeSearch,e,t,o);let r=l();return e.afterSearch&&await el(e.afterSearch,e,t,o,r),r}return(null==(r=e.beforeSearch)?void 0:r.length)||(null==(n=e.afterSearch)?void 0:n.length)?s():l()}(e,t);if("hybrid"===o)return function(e,t,r){var n,o;let i=p();function l(){var r,n,o;let l,s,a=function(e,t,r){var n;let o=function(e){let t=Math.max.apply(Math,e.map(tD));return e.map(e=>{let[r,n]=e;return[r,n/t]})}(tO(e,t,r)),i=t_(e,t,r),l=t.hybridWeights;return function(e,t,r,n){var o;let i=Math.max.apply(Math,e.map(tD)),l=Math.max.apply(Math,t.map(tD)),{text:s,vector:a}=n&&n.text&&n.vector?n:{text:.5,vector:.5},u=new Map,c=e.length,f=(e,t)=>e*s+t*a;for(let t=0;t<c;t++){let[r,n]=e[t],o=f(n/i,0);u.set(r,o)}let d=t.length;for(let e=0;e<d;e++){let[r,n]=t[e],i=n/l,s=null!=(o=u.get(r))?o:0;u.set(r,s+f(0,i))}return[...u].sort((e,t)=>t[1]-e[1])}(o,i,null!=(n=t.term)?n:"",l)}(e,t,void 0);t.facets&&Object.keys(t.facets).length>0&&(l=ty(e,a,t.facets)),t.groupBy&&(s=tT(e,a,t.groupBy));let u=tE(e,a,null!=(r=t.offset)?r:0,null!=(n=t.limit)?n:10).filter(Boolean),c=p(),f={count:a.length,elapsed:{raw:Number(c-i),formatted:h(c-i)},hits:u,...l?{facets:l}:{},...s?{groups:s}:{}};return null!=(o=t.includeVectors)&&o||T(f,Object.keys(e.data.index.vectorIndexes)),f}async function s(){e.beforeSearch&&await es(e.beforeSearch,e,t,void 0);let n=l();return e.afterSearch&&await el(e.afterSearch,e,t,r,n),n}return(null==(n=e.beforeSearch)?void 0:n.length)||(null==(o=e.afterSearch)?void 0:o.length)?s():l()}(e,t);throw k("INVALID_SEARCH_MODE",o)}function tA(e,t,r,n,o){let i=e.data.docs,l=new Map,s=[],a=new Set,u=t.length,c=0;for(let f=0;f<u;f++){let u=t[f];if(void 0===u)continue;let[d,h]=u;if(a.has(d))continue;let p=e.documentsStore.get(i,d),g=S(p,o);if(!(void 0===g||l.has(g))&&(l.set(g,!0),!(++c<=r)&&(s.push({id:Y(e.internalDocumentIDStore,d),score:h,document:p}),a.add(d),c>=r+n)))break}return s}function tE(e,t,r,n){let o=e.data.docs,i=Array.from({length:n}),l=new Set;for(let s=r;s<n+r;s++){let r=t[s];if(void 0===r)break;let[n,a]=r;if(!l.has(n)){let t=e.documentsStore.get(o,n);i[s]={id:Y(e.internalDocumentIDStore,n),score:a,document:t},l.add(n)}}return i}function tP(e,t){e.internalDocumentIDStore.load(e,t.internalDocumentIDStore),e.data.index=e.index.load(e.internalDocumentIDStore,t.index),e.data.docs=e.documentsStore.load(e.internalDocumentIDStore,t.docs),e.data.sorting=e.sorter.load(e.internalDocumentIDStore,t.sorting),e.tokenizer.language=t.language}e.s(["load",()=>tP],4339),Symbol("orama.insertions"),Symbol("orama.removals"),e.s(["documentsStore",()=>tk,"formatElapsedTime",()=>R,"getDocumentIndexId",()=>M,"getDocumentProperties",()=>v,"getInnerType",()=>V,"getVectorSize",()=>F,"index",()=>tR,"internalDocumentIDStore",()=>tz,"isArrayType",()=>L,"isGeoPointType",()=>U,"isVectorType",()=>B,"sorter",()=>tx,"tokenizer",()=>tM,"validateSchema",()=>x],65617),e.i(67907),e.i(35306);var tk=tu,tR=tc,tM=tf,tx=td,tz=th;e.i(65617),e.s([],9169),e.s(["boundedLevenshtein",()=>eh,"convertDistanceToMeters",()=>I,"formatBytes",()=>f,"formatNanoseconds",()=>h,"getNanosecondsTime",()=>p,"normalizeToken",()=>tn,"safeArrayPush",()=>c,"setDifference",()=>A,"setIntersection",()=>_,"setUnion",()=>w,"uniqueId",()=>g],20478),e.i(9169),e.i(20478)}]);